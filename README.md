# é€šç”¨ SVG å˜å½¢å¼•æ“ (Universal SVG Morphing Engine)

è¿™æ˜¯ä¸€ä¸ªåŸºäº React çš„é«˜æ€§èƒ½ SVG è·¯å¾„å˜å½¢ï¼ˆMorphingï¼‰æ¼”ç¤ºé¡¹ç›®ã€‚æ—¨åœ¨æ¢ç´¢ä¸ä¾èµ– GSAP MorphSVG ç­‰ä»˜è´¹åº“çš„æƒ…å†µä¸‹ï¼Œå¦‚ä½•å®ç°ä»»æ„ SVG å½¢çŠ¶ã€ä»»æ„æ•°é‡å…ƒç´ ä¹‹é—´çš„å¹³æ»‘è¿‡æ¸¡åŠ¨ç”»ï¼Œå¹¶ä½¿ç”¨ anime.js 4.x è¿›è¡ŒåŠ¨ç”»è°ƒåº¦ã€‚

## ğŸš€ é¡¹ç›®æ¼”å˜ä¸æ ¸å¿ƒåŠŸèƒ½

æœ¬é¡¹ç›®ç»å†äº†ä» V1 åˆ° V6 çš„è¿­ä»£ï¼Œé€æ­¥è§£å†³äº†å½¢çŠ¶åŒ¹é…ã€å¤šå…ƒç´ æ˜ å°„ã€è‰²å½©è¿‡æ¸¡ä»¥åŠæµ·é‡å…ƒç´ æ¸²æŸ“çš„æ€§èƒ½ç“¶é¢ˆã€‚

### 1. æ ¸å¿ƒåŸç†ï¼šè·¯å¾„é‡é‡‡æ · (Path Resampling)

SVG çš„ d å±æ€§æŒ‡ä»¤å„ä¸ç›¸åŒï¼ˆå¦‚ C æ›²çº¿å¯¹ L ç›´çº¿ï¼‰ã€‚ä¸ºäº†å®ç°â€œä»»æ„â€å˜å½¢ï¼š

- ç®—æ³•ï¼šä½¿ç”¨ getPointAtLength() å°†ä»»æ„ SVG è·¯å¾„æ ‡å‡†åŒ–ä¸ºå›ºå®šæ•°é‡çš„åæ ‡ç‚¹ï¼ˆä¾‹å¦‚ 100 ä¸ªç‚¹ï¼‰ã€‚
- æ’å€¼ï¼šå°†å¤æ‚çš„è´å¡å°”æ›²çº¿è¿ç®—è½¬åŒ–ä¸ºç®€å•çš„é¡¶ç‚¹çº¿æ€§æ’å€¼ã€‚

### 2. æ™ºèƒ½å¯¹é½ (Smart Alignment) & è‡ªåŠ¨æ–¹å‘çº æ­£

- **é—®é¢˜**ï¼šç›´æ¥æ’å€¼ä¼šå¯¼è‡´å›¾å½¢åœ¨å˜å½¢æ—¶â€œè‡ªæˆ‘ç©¿æ’â€æˆ–â€œç¿»è½¬â€ï¼ˆæ‰“ç»“ç°è±¡ï¼‰ï¼Œå°¤å…¶æ˜¯å½“æºå½¢çŠ¶å’Œç›®æ ‡å½¢çŠ¶çš„ç»˜åˆ¶æ–¹å‘ä¸ä¸€è‡´æ—¶ï¼ˆä¾‹å¦‚ï¼šé¡ºæ—¶é’ˆç»˜åˆ¶çš„å…­è¾¹å½¢ â†” é€†æ—¶é’ˆç»˜åˆ¶çš„åœ†å½¢ï¼‰ã€‚
- **è§£å†³**ï¼š
  1. **æœ€ä½³åç§»é‡ (Best Offset)**ï¼šå®ç°äº†ç±»ä¼¼äº GSAP shapeIndex çš„ç®—æ³•ã€‚é€šè¿‡æ—‹è½¬ç›®æ ‡ç‚¹é›†ï¼Œå¯»æ‰¾æ¬§å‡ é‡Œå¾—è·ç¦»æ€»å’Œæœ€å°çš„å¯¹é½ç‚¹ï¼Œç¡®ä¿ç‚¹å¯¹ç‚¹ç§»åŠ¨è·ç¦»æœ€çŸ­ã€‚
  2. **åŒå‘æ£€æµ‹ (Bidirectional Detection)**ï¼š**[V6 æ–°å¢]** å¼•æ“ä¼šè‡ªåŠ¨è®¡ç®—â€œæ­£å‘â€å’Œâ€œåå‘â€ä¸¤ç§è·¯å¾„çš„åŒ¹é…åˆ†æ•°ã€‚å¦‚æœåè½¬è·¯å¾„èƒ½å¤§å¹…é™ä½æ€»è·ç¦»ï¼Œå¼•æ“ä¼šè‡ªåŠ¨ç¿»è½¬ç›®æ ‡ç‚¹åºã€‚è¿™å®Œç¾è§£å†³äº†å›  Winding Orderï¼ˆç¼ ç»•æ–¹å‘ï¼‰ä¸åŒå¯¼è‡´çš„â€œå†…ç¿»â€æ‰­æ›²é—®é¢˜ã€‚

### 3. å¤šå¯¹å¤šæ˜ å°„ (N-to-M Morphing)

æ”¯æŒæºå½¢çŠ¶å’Œç›®æ ‡å½¢çŠ¶æ‹¥æœ‰ä¸åŒæ•°é‡çš„å­è·¯å¾„ï¼ˆä¾‹å¦‚ï¼š1ä¸ªåœ† â†” 150ä¸ªç²’å­ï¼‰ã€‚

- V6 ç­–ç•¥ (Collapse & Split)ï¼š
  - åç¼© (Collapse)ï¼šå½“ N > M æ—¶ï¼Œå¤šä¸ªæºå…ƒç´ é€šè¿‡å–æ¨¡æ˜ å°„ (i % M) é£å‘åŒä¸€ä¸ªç›®æ ‡å…ƒç´ ã€‚
  - åˆ†è£‚ (Split)ï¼šå½“ N < M æ—¶ï¼Œæºå…ƒç´ è¢«é€»è¾‘å¤åˆ¶ï¼Œåˆ†åˆ«é£å‘ä¸åŒçš„ç›®æ ‡å…ƒç´ ã€‚
  - å…¨å‘˜å‚æˆ˜ï¼šåºŸå¼ƒäº†â€œæ·¡å…¥æ·¡å‡ºâ€ç­–ç•¥ï¼Œç¡®ä¿æ‰€æœ‰å…ƒç´ éƒ½å‚ä¸å‡ ä½•å˜å½¢ï¼Œè§†è§‰æ•ˆæœæ›´éœ‡æ’¼ã€‚

### 4. è‰²å½©æ’å€¼

- æ”¯æŒ HEX é¢œè‰²çš„çº¿æ€§è¿‡æ¸¡ï¼Œä¸å½¢çŠ¶å˜å½¢åŒæ­¥ã€‚

##âš¡ï¸ æ€§èƒ½ä¼˜åŒ–æªæ–½ (Performance Optimizations)
å½“å±å¹•ä¸ŠåŒæ—¶æ¸²æŸ“ 200+ ä¸ª SVG è·¯å¾„å¹¶è¿›è¡Œ 60fps åŠ¨ç”»æ—¶ï¼Œæ€§èƒ½æ˜¯æœ€å¤§çš„æŒ‘æˆ˜ã€‚æˆ‘ä»¬é‡‡å–äº†ä»¥ä¸‹â€œæ ¸å¼¹çº§â€ä¼˜åŒ–ï¼š

### 1. ç»•è¿‡ React æ¸²æŸ“ (Direct DOM Manipulation)

- ç—›ç‚¹ï¼šReact çš„ setState -> Diff -> Render æµç¨‹åœ¨æ¯å¸§é«˜é¢‘è°ƒç”¨ä¸‹å¼€é”€è¿‡å¤§ã€‚
- æ–¹æ¡ˆï¼šä½¿ç”¨ useRef è·å– DOM èŠ‚ç‚¹ï¼Œåœ¨ anime.js çš„æ›´æ–°å›è°ƒä¸­ç›´æ¥è°ƒç”¨ element.setAttribute('d', ...)ã€‚
- æ”¶ç›Šï¼šæ€§èƒ½æå‡çº¦ 10 å€ï¼Œæ¶ˆé™¤äº† React è°ƒå’Œè¿‡ç¨‹çš„å¼€é”€ã€‚

### 2. åŠ¨æ€ç²¾åº¦è°ƒæ•´ (Dynamic LOD - Level of Detail)

æ ¹æ®å½“å‰æ¸²æŸ“çš„å…ƒç´ æ€»æ•°ï¼ŒåŠ¨æ€è°ƒæ•´æ¯ä¸ªè·¯å¾„çš„é‡‡æ ·ç‚¹æ•°ï¼š

| å…ƒç´ æ•°é‡ | é‡‡æ ·ç²¾åº¦ | è¯´æ˜                                   |
| :------- | :------- | :------------------------------------- |
| < 50     | 120 ç‚¹   | æé«˜ç²¾åº¦ï¼Œé€‚åˆå±•ç¤ºç»†èŠ‚                 |
| 50 - 100 | 60 ç‚¹    | å¹³è¡¡ç”»è´¨ä¸æµç•…åº¦                       |
| > 100    | 30 ç‚¹    | ä½ç²¾åº¦ï¼Œä¾é æ•°é‡å¼¥è¡¥ç»†èŠ‚ï¼Œä¼˜å…ˆä¿è¯ FPS |

### 3. æ•´æ•°åæ ‡ä¼˜åŒ– (Integer Coordinates)

- ç—›ç‚¹ï¼šæµ®ç‚¹æ•°è·¯å¾„å­—ç¬¦ä¸²ï¼ˆå¦‚ M 10.123,20.456 L...ï¼‰è¿‡é•¿ï¼Œæµè§ˆå™¨è§£æå’Œå­—ç¬¦ä¸²æ‹¼æ¥è€—æ—¶ã€‚
- æ–¹æ¡ˆï¼šä½¿ç”¨ä½è¿ç®—å–æ•´ (x + 0.5) | 0ã€‚
- æ”¶ç›Šï¼šç”Ÿæˆçš„ d å±æ€§å­—ç¬¦ä¸²é•¿åº¦å‡å°‘ 50% ä»¥ä¸Šï¼Œè§£ææ›´å¿«ï¼Œä¸”è‚‰çœ¼å‡ ä¹æ— æ³•å¯Ÿè§‰ 0.5px çš„æŠ–åŠ¨ã€‚

## ğŸ›  ä»£ç ç»“æ„

- src/data/menuItems.js: å…¥å£èœå•çš„ Tile é…ç½®ï¼ˆæ ‡é¢˜ã€æè¿°ã€ä¸»é¢˜è‰²ç­‰ï¼‰ã€‚
- src/pages/EntryMenu.jsx: æ–°å…¥å£èœå•é¡µé¢ï¼Œè´Ÿè´£æ¸²æŸ“åŠŸèƒ½å…¥å£ã€‚
- src/features/basic-morph/BasicMorphTest.jsx: åŸºç¡€ Morph æµ‹è¯•é¡µï¼Œæä¾›æœ€å°åŒ–çš„è·¯å¾„ä¸ transform éªŒè¯åœºæ™¯ã€‚
- src/lib/svgMorphEngine.js: ç‹¬ç«‹çš„ SVG morph å¼•æ“æ¨¡å—ï¼ŒåŠ¨ç”»é©±åŠ¨æ”¹ç”± anime.js 4.x è´Ÿè´£è°ƒåº¦ã€‚
  - samplePath: è·¯å¾„é‡‡æ ·ã€‚
  - findBestOffset: **[V6]** è®¡ç®—æœ€ä½³æ—‹è½¬åç§»é‡ä¸åŒ¹é…åˆ†æ•°ï¼ˆåŒå‘æ£€æµ‹ï¼‰ã€‚
  - createMorphInterpolator: åˆ›å»ºåŒ…å«æ­£åå‘è‡ªåŠ¨çº æ­£çš„æ’å€¼å™¨ã€‚
  - createColorLerp / lerpColor: é¢œè‰²æ’å€¼ã€‚
  - buildStaticPathD / buildAnimatedPathD: è·¯å¾„å­—ç¬¦ä¸²æ„å»ºã€‚
  - createMorphEngine: åŠ¨ç”»é©±åŠ¨ä¸æ³¨å†Œç®¡ç†ï¼Œæ”¯æŒ Timeline æ¥å…¥ä¸ Transform æ’å€¼ã€‚
- src/features/universal-morph/UniversalMorph.jsx: å˜å½¢å¼•æ“ä¸»ç»„ä»¶ï¼Œè´Ÿè´£ UI äº¤äº’ä¸å¼•æ“æ¥å…¥ã€‚
  - generate\*: å„ç§å¤æ‚ SVG è·¯å¾„ç”Ÿæˆå™¨ï¼ˆåŸå¸‚ã€èŠ±æœµã€çŸ©é˜µç­‰ï¼‰ã€‚
  - SHAPE_LIBRARY: é¢„è®¾çš„å›¾å½¢æ•°æ®ä»“åº“ã€‚
  - MorphingPath: å•ä¸ªè·¯å¾„ç»„ä»¶ï¼Œè´Ÿè´£åˆå§‹åŒ–æ•°æ®å’Œæ³¨å†Œ DOM å¼•ç”¨ã€‚
- src/features/infographic-morph/InfographicMorph.jsx: Infographic SVG å½¢æ€é¡µï¼Œå ä½ç”¨äºæ¥å…¥ AntV Infographic ç”Ÿæˆçš„ SVG å½¢æ€ç»“æœã€‚

## ğŸ“¦ å¦‚ä½•ä½¿ç”¨

æœ¬é¡¹ç›®å·²æ•´ç†ä¸ºå¯ç›´æ¥è¿è¡Œçš„ Vite + React åº”ç”¨ï¼ˆUI ä¾èµ– Tailwind CDN ä¸ lucide-react å›¾æ ‡åº“ï¼‰ã€‚

### 1. å®‰è£…ä¾èµ–

```bash
yarn install
```

### 2. å¯åŠ¨å¼€å‘ç¯å¢ƒ

```bash
yarn dev
```

### 3. å…¥å£èœå•

åº”ç”¨å…¥å£ç°åœ¨æ˜¯ä¸€ä¸ªèœå•é¡µé¢ï¼Œé»˜è®¤å±•ç¤ºå¯ç”¨çš„æ¼”ç¤ºå…¥å£ã€‚å½“å‰åŒ…æ‹¬ï¼š

- åŸºç¡€ Morph æµ‹è¯•é¡µï¼šæœ€å°åŒ–ç¤ºä¾‹ï¼ŒéªŒè¯è·¯å¾„ä¸ transform çš„ morph æ•ˆæœã€‚
- é€šç”¨ SVG å˜å½¢å¼•æ“æ¼”ç¤ºï¼šå¤šå½¢çŠ¶ã€å¤šå…ƒç´ è·¯å¾„çš„é«˜æ€§èƒ½ morphã€‚
- Infographic SVG å½¢æ€é¡µï¼šåŸºäº AntV Infographic çš„ç¤ºä¾‹å ä½é¡µã€‚

ä½ å¯ä»¥åœ¨ `src/data/menuItems.js` ä¸­ç»§ç»­æ·»åŠ æ–°çš„ Tile é…ç½®ã€‚

### 4. ç»„ä»¶å…¥å£

å¦‚æœä½ æƒ³åœ¨åˆ«çš„é¡¹ç›®ä¸­å¤ç”¨ï¼Œå¯ä»¥ç›´æ¥å¼•å…¥ç»„ä»¶ï¼š

```js
import UniversalMorph from "./features/universal-morph/UniversalMorph";

function App() {
  return (
    <div className="App">
      <UniversalMorph />
    </div>
  );
}
```

### 5. å¼•æ“æ¨¡å—å¤ç”¨

å¦‚æœä½ åªéœ€è¦æ ¸å¿ƒç®—æ³•ä¸åŠ¨ç”»é©±åŠ¨ï¼Œå¯ä»¥å•ç‹¬å¼•å…¥å¼•æ“æ¨¡å—ï¼š

```js
import { Timeline } from "animejs";
import {
  createMorphEngine,
  createMorphInterpolator,
  createColorLerp,
} from "./lib/svgMorphEngine";

// 1. åˆå§‹åŒ–å¼•æ“
const engine = createMorphEngine({ duration: 2000 });

// 2. å‡†å¤‡æ•°æ®
// isMassive: true å¯è·³è¿‡è€—æ—¶çš„å¯¹é½è®¡ç®—ï¼Œé€‚åˆç²’å­æ•ˆæœ
const interpolator = createMorphInterpolator(startD, endD, {
  samples: 120,
  optimize: true,
  isMassive: false,
});
const color = createColorLerp("#3B82F6", "#F59E0B");

// 3. æ³¨å†Œ DOM (é€šå¸¸åœ¨ç»„ä»¶ mount æ—¶)
// è¿”å›çš„ unregister å‡½æ•°ç”¨äºæ¸…ç†
const unregister = engine.register({
  dom: myPathElement,
  data: interpolator,
  color: color,
  samples: 120,
  // [å¯é€‰] æ”¯æŒ Transform å±æ€§æ’å€¼
  transform: {
    start: { x: 0, y: 0, r: 0, cx: 100, cy: 100, s: 1 },
    end: { x: 50, y: 20, r: 45, cx: 100, cy: 100, s: 0.8 },
  },
});

// 4. æ’­æ”¾åŠ¨ç”»
// æ–¹å¼ A: ç‹¬ç«‹æ’­æ”¾
engine.play();

// æ–¹å¼ B: ç»“åˆ Anime.js Timeline (æ”¯æŒæ—¶é—´è½´ç¼–æ’)
const tl = new Timeline();
engine.play({
  timeline: tl,
  offset: 200, // åœ¨æ—¶é—´è½´ 200ms å¤„æ’å…¥åŠ¨ç”»
});
tl.play();
```

## ğŸ”® æœªæ¥å±•æœ›

- Web Worker: å°†ç¹é‡çš„ç‚¹æ’å€¼è®¡ç®—æ”¾å…¥ Worker çº¿ç¨‹ã€‚
- WebGL/Canvas: å¯¹äºè¶…è¿‡ 1000 ä¸ªç²’å­çš„å˜å½¢ï¼ŒSVG æ€§èƒ½ä¼šè¾¾åˆ°ç“¶é¢ˆï¼Œæœªæ¥å¯è¿ç§»è‡³ Canvas æ¸²æŸ“ã€‚
